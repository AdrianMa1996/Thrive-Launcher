<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ThriveLauncher.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:ThriveLauncher.Controls"
        xmlns:p="clr-namespace:ThriveLauncher.Properties"
        mc:Ignorable="d" d:DesignWidth="950" d:DesignHeight="600"
        Width="950" Height="600"
        MinWidth="900" MinHeight="550"
        x:Class="ThriveLauncher.Views.MainWindow"
        Icon="/Assets/Icons/icon.ico"
        Title="Thrive Launcher"
        FontFamily="/Assets/Roboto/Roboto-Regular.ttf">

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+D" Command="{Binding DevCenterViewActivation}">
            <KeyBinding.CommandParameter>
                <x:Int32>0</x:Int32>
            </KeyBinding.CommandParameter>
        </KeyBinding>
        <KeyBinding Gesture="Ctrl+E" Command="{Binding DevCenterViewActivation}">
            <KeyBinding.CommandParameter>
                <x:Int32>1</x:Int32>
            </KeyBinding.CommandParameter>
        </KeyBinding>
        <KeyBinding Gesture="Ctrl+V" Command="{Binding DevCenterViewActivation}">
            <KeyBinding.CommandParameter>
                <x:Int32>2</x:Int32>
            </KeyBinding.CommandParameter>
        </KeyBinding>
        <KeyBinding Gesture="Ctrl+C" Command="{Binding DevCenterViewActivation}">
            <KeyBinding.CommandParameter>
                <x:Int32>3</x:Int32>
            </KeyBinding.CommandParameter>
        </KeyBinding>
        <!-- TODO: implement this keybinding and make sure it doesn't mess things up if game is currently running -->
        <!--<KeyBinding Gesture="Ctrl+S" Command="{Binding PlayClicked}" />-->
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenSettings}" />
        <KeyBinding Gesture="Ctrl+L" Command="{Binding ToggleLinksView}" />
    </Window.KeyBindings>

    <Grid Margin="0" ColumnDefinitions="*" RowDefinitions="*">
        <Viewbox Stretch="UniformToFill">
            <Image Source="/Assets/Planet-1.jpg" />
        </Viewbox>

        <DockPanel LastChildFill="True">
            <Border DockPanel.Dock="Bottom" Background="{DynamicResource BottomBackground}"
                    HorizontalAlignment="Stretch" Padding="15">
                <StackPanel HorizontalAlignment="Center" Orientation="Horizontal" Spacing="3">
                    <Button FontSize="18" VerticalAlignment="Stretch" Command="{Binding ToggleLinksView}">
                        <TextBlock VerticalAlignment="Center" Text="{x:Static p:Resources.LinksButton}" />
                    </Button>
                    <Button VerticalAlignment="Stretch" Command="{Binding OpenSettings}">
                        <Image Source="/Assets/gear.png" Width="32" />
                    </Button>
                    <Button FontSize="28" Classes="PlayButton" Command="{Binding ToggleLinksView}"
                            Content="{x:Static p:Resources.PlayButton}" />

                    <ComboBox SelectedIndex="0" FontSize="20" VerticalAlignment="Stretch" Classes="VersionSelect"
                              SelectionChanged="SelectedVersionChanged">
                        <ComboBoxItem>DevBuild Linux x64</ComboBoxItem>
                        <ComboBoxItem>Thrive 0.5.9 Linux x64</ComboBoxItem>
                    </ComboBox>
                    <StackPanel Orientation="Horizontal" IsVisible="{Binding ShowDevCenterStatusArea}"
                                Margin="2 0 0 0 ">
                        <Button Classes="TextLink" Command="{Binding OpenDevCenterConnectionMenu}"
                                IsVisible="{Binding !HasDevCenterConnection}"
                                Content="{x:Static p:Resources.ConnectToDevCenterPrompt}" />
                        <StackPanel Orientation="Horizontal" IsVisible="{Binding HasDevCenterConnection}">
                            <TextBlock IsVisible="{Binding DevCenterConnectionIsDeveloper}" VerticalAlignment="Center"
                                       Text="{x:Static p:Resources.ConnectedDeveloperGreeting}" />

                            <TextBlock IsVisible="{Binding !DevCenterConnectionIsDeveloper}" VerticalAlignment="Center"
                                       Text="{x:Static p:Resources.ConnectedSupporterGreeting}" />

                            <Button Classes="TextLink" Command="{Binding OpenDevCenterConnectionMenu}"
                                    Content="{Binding DevCenterConnectedUser}">
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Border>

            <Grid DockPanel.Dock="Top" ColumnDefinitions="4*, 12, 6*">
                <Border Grid.Column="0" DockPanel.Dock="Left" Background="{DynamicResource FeedBackground}"
                        CornerRadius="2" Margin="6,4,0,6">
                    <ScrollViewer HorizontalScrollBarVisibility="Disabled" Padding="3">
                        <StackPanel MinWidth="350">
                            <TextBlock FontSize="24" Text="{x:Static p:Resources.DevelopmentFeedTitle}" />
                            <Border BorderBrush="{DynamicResource BlueElement}" BorderThickness="1" Margin="0 0 0 3" />
                            <TextBlock IsVisible="{Binding !WebFeedsEnabled}"
                                       Text="{x:Static p:Resources.WebContentIsDisabled}" />
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                <GridSplitter Grid.Column="1" Background="Transparent" ResizeDirection="Columns" />
                <Border Grid.Column="2" Background="{DynamicResource FeedBackground}"
                        CornerRadius="2" Margin="0,4,6,6">
                    <ScrollViewer HorizontalScrollBarVisibility="Disabled" Padding="3">
                        <StackPanel>
                            <TextBlock FontSize="24" Text="{x:Static p:Resources.NewsFeedTitle}" />
                            <Border BorderBrush="{DynamicResource BlueElement}" BorderThickness="1" Margin="0 0 0 3" />
                            <TextBlock IsVisible="{Binding !WebFeedsEnabled}"
                                       Text="{x:Static p:Resources.WebContentIsDisabled}" />
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>

        </DockPanel>

        <controls:PopupDialog Title="{x:Static p:Resources.LinksPopupTitle}"
                              CloseCommand="{Binding CloseLinksClicked}" ShowPopup="{Binding ShowLinksPopup}">
            <Grid ColumnDefinitions="*, *" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto">
                <Button Grid.Column="0" Grid.Row="0" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkMainWebsite}" FontSize="20" />
                <Button Grid.Column="0" Grid.Row="1" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkDevelopmentForums}" />
                <Button Grid.Column="0" Grid.Row="2" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkCommunityForums}" />
                <Button Grid.Column="0" Grid.Row="3" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkDeveloperWiki}" />
                <Button Grid.Column="0" Grid.Row="4" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkPatreon}" />
                <Button Grid.Column="0" Grid.Row="5" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkDonate}" />
                <Button Grid.Column="0" Grid.Row="6" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkThriveDevCenter}" />
                <Button Grid.Column="0" Grid.Row="7" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkThriveSteam}" />
                <Button Grid.Column="0" Grid.Row="8" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkThriveItch}" />

                <Button Grid.Column="1" Grid.Row="0" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkThriveGithub}" FontSize="20" />
                <Button Grid.Column="1" Grid.Row="1" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkLauncherGithub}" />
                <Button Grid.Column="1" Grid.Row="2" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkFanWiki}" />
                <Button Grid.Column="1" Grid.Row="3" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkDiscordServer}" />
                <Button Grid.Column="1" Grid.Row="4" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkSubreddit}" />
                <Button Grid.Column="1" Grid.Row="5" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkYouTubeChannel}" />
                <Button Grid.Column="1" Grid.Row="6" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkTwitterFeed}" />
                <Button Grid.Column="1" Grid.Row="7" Classes="TextLink"
                        Content="{x:Static p:Resources.ExternalLinkFacebookPage}" />
            </Grid>
        </controls:PopupDialog>

        <controls:PopupDialog ShowTitle="False" ShowCloseX="False" CloseCommand="{Binding CloseSettingsClicked}"
                              ShowPopup="{Binding ShowSettingsPopup}" ShowOKButton="True">
            <RelativePanel Width="750" Height="400">
                <TabControl HorizontalAlignment="Stretch"
                            RelativePanel.AlignLeftWithPanel="True"
                            RelativePanel.AlignRightWithPanel="True"
                            RelativePanel.AlignTopWithPanel="True"
                            RelativePanel.AlignBottomWithPanel="True">
                    <TabItem Header="{x:Static p:Resources.ThriveOptions}">
                        <StackPanel>
                            <TextBlock FontSize="16" Text="{x:Static p:Resources.LaunchOptionsTitle}" />
                            <CheckBox>
                                <TextBlock TextWrapping="Wrap" Text="{x:Static p:Resources.LaunchOptionDisableVideos}" />
                            </CheckBox>
                            <CheckBox>
                                <TextBlock TextWrapping="Wrap" Text="{x:Static p:Resources.LaunchOptionForceGLES2}" />
                            </CheckBox>
                        </StackPanel>
                    </TabItem>
                    <TabItem Header="{x:Static p:Resources.LauncherOptions}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Margin="0 0 1 0" Text="{x:Static p:Resources.LauncherVersionDisplay}" />
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </StackPanel>
                            <Border DockPanel.Dock="Top" Padding="0" BorderThickness="1"
                                    BorderBrush="{DynamicResource BlueElement}" />
                            <CheckBox Content="{x:Static p:Resources.LauncherOptionWebFeeds}" />

                            <CheckBox Content="{x:Static p:Resources.LauncherOptionHideOnPlay}" />

                            <CheckBox Content="{x:Static p:Resources.LauncherOptionCloseAfterPlaying}" />

                            <CheckBox Content="{x:Static p:Resources.LauncherOptionCloseAfterStart}" />

                            <CheckBox Content="{x:Static p:Resources.LauncherOptionAllowSeamlessMode}" />

                            <!-- TODO store version specific settings -->

                            <StackPanel Orientation="Horizontal" Margin="0 5">
                                <TextBlock Margin="0 0 2 0" Text="{x:Static p:Resources.LauncherSelectedLanguage}"
                                           VerticalAlignment="Center" />
                                <ComboBox x:Name="LanguageComboBox" SelectionChanged="LanguageSelectionChanged" />
                            </StackPanel>

                            <!-- TODO red warning button -->
                            <Border DockPanel.Dock="Top" Padding="0" BorderThickness="1" Margin="0 0 0 3"
                                    BorderBrush="{DynamicResource BlueElement}" />
                            <Button Classes="DialogButton" Content="{x:Static p:Resources.ResetAllSettings}" />
                        </StackPanel>
                    </TabItem>
                    <TabItem Header="{x:Static p:Resources.InstalledVersions}">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="2">
                                <Button Classes="DialogButton" Content="{x:Static p:Resources.BrowseInstalledFiles}" />
                                <Button Classes="DialogButton" Content="{x:Static p:Resources.SelectInstallLocation}" />
                                <Button Classes="DialogButton"
                                        ToolTip.Tip="{x:Static p:Resources.ResetInstallLocationToolTip}">
                                    <Image Height="16" Source="{DynamicResource RevertIconWhite}" />
                                </Button>
                            </StackPanel>
                            <Border DockPanel.Dock="Top" Margin="0 3" Padding="0" BorderThickness="1"
                                    BorderBrush="{DynamicResource BlueElement}" />

                            <WrapPanel Orientation="Horizontal" Margin="0 5">
                                <TextBlock Margin="0 0 2 0" Text="{x:Static p:Resources.FolderPathDisplay}" />
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </WrapPanel>

                            <!-- TODO: showing the installed versions with delete buttons -->
                            <ScrollViewer>

                            </ScrollViewer>
                        </StackPanel>
                    </TabItem>
                    <TabItem Header="{x:Static p:Resources.CacheConfigurationTab}">
                        <StackPanel>
                            <WrapPanel Orientation="Horizontal" Margin="0 0 0 5">
                                <TextBlock Margin="0 0 2 0">Temporary downloads folder:</TextBlock>
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </WrapPanel>

                            <!-- TODO: showing temporary folder stats / existing things -->
                            <ScrollViewer>

                            </ScrollViewer>

                            <TextBlock Margin="0 3" TextWrapping="Wrap" FontSize="12">
                                Note: moving temporary location won't delete existing files to prevent accidentally deleting files unrelated to Thrive
                            </TextBlock>

                            <StackPanel Orientation="Horizontal" Spacing="2">
                                <Button Classes="DialogButton">Select Temporary Files Location</Button>
                                <Button Classes="DialogButton" ToolTip.Tip="Reset Temporary Files Location">
                                    <Image Height="16" Source="{DynamicResource RevertIconWhite}" />
                                </Button>
                                <Button Classes="DialogButton">Clear</Button>
                            </StackPanel>

                            <Border DockPanel.Dock="Top" Margin="0 3" Padding="0" BorderThickness="1"
                                    BorderBrush="{DynamicResource BlueElement}" />
                            <WrapPanel Orientation="Horizontal" Margin="0 0 0 5">
                                <TextBlock Margin="0 0 2 0">DevBuilds file cache:</TextBlock>
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </WrapPanel>

                            <StackPanel Orientation="Horizontal" Spacing="2">
                                <Button Classes="DialogButton">Select Cache Location</Button>
                                <Button Classes="DialogButton" ToolTip.Tip="Reset Cache Location">
                                    <Image Height="16" Source="{DynamicResource RevertIconWhite}" />
                                </Button>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0 10">
                                <TextBlock Margin="0 0 2 0">Cache size:</TextBlock>
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </StackPanel>
                            <Button Classes="DialogButton">Clear</Button>
                        </StackPanel>
                    </TabItem>
                </TabControl>
                <Button Classes="Close" Command="{Binding CloseSettingsClicked}" HorizontalAlignment="Right"
                        Width="36" Height="24"
                        Margin="0 4 0 0"
                        RelativePanel.AlignRightWithPanel="True"
                        RelativePanel.AlignTopWithPanel="True">
                    <Image Height="16" />
                </Button>
            </RelativePanel>
        </controls:PopupDialog>

        <!-- TODO: show the ok button when it makes sense -->
        <controls:PopupDialog Title="DevCenter Connection" CloseCommand="{Binding CloseDevCenterMenuClicked}"
                              ShowPopup="{Binding ShowDevCenterPopup}" ShowOKButton="False">
            <TabControl MinWidth="700" MinHeight="400" MaxHeight="400" MaxWidth="700"
                        RelativePanel.AlignLeftWithPanel="True"
                        RelativePanel.AlignRightWithPanel="True"
                        RelativePanel.AlignTopWithPanel="True"
                        RelativePanel.AlignBottomWithPanel="True">
                <TabItem Header="Info">
                    <StackPanel>
                        <!-- Connected controls -->
                        <StackPanel IsVisible="True">
                            <WrapPanel Orientation="Horizontal" Margin="0 5">
                                <TextBlock Margin="0 0 2 0">Connected as:</TextBlock>
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </WrapPanel>

                            <TextBlock IsVisible="{Binding DevCenterConnectionIsDeveloper}">
                                You are a developer
                            </TextBlock>

                            <RadioButton GroupName="DevBuildTypeSelection">
                                <TextBlock TextWrapping="Wrap">Build of the day (BOTD), recommended</TextBlock>
                            </RadioButton>
                            <RadioButton GroupName="DevBuildTypeSelection">
                                <TextBlock TextWrapping="Wrap">
                                    Latest (changes a lot randomly as this is literally a build from the latest code commit)
                                </TextBlock>
                            </RadioButton>
                            <RadioButton GroupName="DevBuildTypeSelection">
                                <TextBlock TextWrapping="Wrap">Manually selected in "Specific Build" tab</TextBlock>
                            </RadioButton>

                            <Button Classes="DialogButton" Margin="0 30">Logout</Button>

                        </StackPanel>
                        <!-- Not connected controls -->
                        <StackPanel IsVisible="False">
                            <TextBlock Margin="0 0 0 5" TextWrapping="Wrap">
                                TODO: connection explanation text
                            </TextBlock>
                            <Button Classes="TextLink">Instructions on our Wiki</Button>

                            <TextBox Watermark="Connection key" />

                            <Button Classes="DialogButton">Connect</Button>
                        </StackPanel>


                    </StackPanel>
                </TabItem>
                <TabItem Header="Specific Build" IsEnabled="True">
                    <StackPanel>
                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
                            <WrapPanel Orientation="Horizontal" Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="3"
                                       Margin="0 0 2 0">
                                <TextBlock Margin="0 0 2 0">Manually entered hash:</TextBlock>
                                <TextBlock Text="{Binding LauncherVersion}" />
                            </WrapPanel>

                            <TextBox Grid.Column="1" Grid.Row="1" Watermark="Enter build hash (commit)" />

                            <Button Grid.Column="2" Grid.Row="1" Classes="DialogButton" HorizontalAlignment="Right"
                                    ToolTip.Tip="Select the manually entered hash value to be used from the input box as the selected DevBuild to play when playing a DevBuild">
                                Select
                            </Button>
                        </Grid>

                        <Border DockPanel.Dock="Top" Margin="0 3" Padding="0" BorderThickness="1"
                                BorderBrush="{DynamicResource BlueElement}" />

                        <Button Classes="DialogButton" Margin="0 10">Fetch Latest Builds</Button>

                        <!-- TODO: retrieve and show the latest 100 builds (when button is pressed) -->
                        <ScrollViewer>

                        </ScrollViewer>
                    </StackPanel>
                </TabItem>
            </TabControl>
        </controls:PopupDialog>

        <controls:PopupDialog Title="{x:Static p:Resources.SettingsImportOldTitle}"
                              CloseCommand="{Binding SkipSettingsUpgrade}"
                              ShowPopup="{Binding ShowSettingsUpgrade}" ShowOKButton="False">
            <DockPanel LastChildFill="True" MaxWidth="600">
                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="2"
                            Margin="0 15 0 0">
                    <Button Classes="DialogButton" Command="{Binding PerformSettingsUpgrade}"
                            Content="{x:Static p:Resources.PerformImport}" />

                    <Button Classes="DialogButton Danger" Command="{Binding SkipSettingsUpgrade}"
                            Content="{x:Static p:Resources.SkipAction}" />
                </StackPanel>

                <TextBlock DockPanel.Dock="Top" TextWrapping="Wrap"
                           Text="{x:Static p:Resources.SettingsImportOldExplanation}" />
            </DockPanel>
        </controls:PopupDialog>

        <controls:PopupDialog Title="{Binding NoticeMessageTitle}" ShowOKButton="{Binding CanDismissNotice}"
                              ShowCloseX="{Binding CanDismissNotice}" Background="White" Foreground="Black"
                              CloseCommand="{Binding CloseNotice}" ShowPopup="{Binding HasNoticeMessage}">
            <TextBlock Text="{Binding NoticeMessageText}" TextWrapping="Wrap" />
        </controls:PopupDialog>
    </Grid>

</Window>
